!function(){"use strict";function t(t){return t.split("/").pop().split("?").shift()}function n(t){return{no:parseInt([t.find(".gall_tit a").first().attr("href").split(/[&?]/gi).find(t=>t.startsWith("no="))].map(t=>t||"no=-1")[0].split("no=")[1]),url:location.origin+t.find(".gall_tit a").attr("href"),gall_subject:t.find(".gall_subject").text(),subject:t.find(".gall_tit a").first().text(),subject_type:t.find(".gall_tit em").first().attr("class").split(" ").pop(),comments:t.find(".gall_tit .reply_num")[0]&&t.find(".gall_tit .reply_num").text().split("/")[0]?parseInt(t.find(".gall_tit .reply_num").text().split("/")[0].replace(/[\[\]]/g,"")):0,voice_comments:t.find(".gall_tit .reply_num")[0]&&t.find(".gall_tit .reply_num").text().split("/")[1]?parseInt(t.find(".gall_tit .reply_num").text().split("/")[1].replace(/[\[\]]/g,"")):0,uid:t.find(".gall_writer").data("uid"),ip:t.find(".gall_writer").data("ip"),nick:t.find(".gall_writer").data("nick"),nick_type:t.find(".writer_nikcon img")[0]?t.find(".writer_nikcon img").attr("src").split(".").slice(-2).shift().split("/").slice(-1).pop():void 0,date:t.find(".gall_date").attr("title"),count:parseInt(t.find(".gall_count").text()),recommends:parseInt(t.find(".gall_recommend").text())}}Element.prototype.appendAfter=function(t){t.parentNode.insertBefore(this,t.nextSibling)};const e=".gall_list .ub-content:not(:has(.gall_num:contains(공지), .gall_num:contains(설문)))";function i(t){return{no:parseInt(t.find("a").attr("href").split("/").pop().split("?").shift()),url:t.find("a").attr("href"),subject:t.find(".detail-txt").text().trim(),subject_type:t.find(".sp-lst").attr("class").split(" ").pop(),nick:t.find(".ginfo > li:nth-child(1)").text(),nick_type:(t.find(".sp-nick").attr("class")?t.find(".sp-nick").attr("class"):"").split(" ").pop(),date:t.find(".ginfo > li:nth-child(2)").text(),count:parseInt(t.find(".ginfo > li:nth-child(3)").text().split(" ").pop()),recommands:parseInt(t.find(".ginfo > li:nth-child(4)").text().split(" ").pop()),comments:parseInt(t.find(".ct").text()),voice_comments:t.find(".vo-txt")[0]?parseInt(t.find(".vo-txt").text()):0}}const o=".gall-detail-lnktb";function a(t){return{no:t.data("no"),ip:t.find(".gall_writer").data("ip"),nick:t.find(".gall_writer").data("nick"),nick_type:t.find(".writer_nikcon img")[0]?t.find(".writer_nikcon img").attr("src").split(".").slice(-2).shift().split("/").slice(-1).pop():void 0,comment:t.find(".usertxt").text(),date:t.find(".date_time").text()}}const r=".cmt_info, .reply_info";function l(t){return{no:t.attr("no"),nick:t.find(".nick").text(),nick_type:(t.find(".sp-nick").attr("class")?t.find(".sp-nick").attr("class"):"").split(" ").pop(),date:t.find(".date").text(),comment:t.find(".txt").text()}}const c=".all-comment-lst > li.comment, .all-comment-lst > li.comment-add";function s(t,n,e){"true"==localStorage.MENNAS_RESTORE_MODE?(function(t){t.find("span").css("color","#000000"),t.find("li").css("color","#000000"),t.parent().hasClass("ub-content")&&(t=t.parent()),t.css("border","2px solid #413160"),t.css("background-color","rgba(65, 49, 96, 0.5)")}(t),function(t,n,e){var i=$('<p class="blocked_info" style="font-weight: bold; white-space: break-spaces;">').text(`* Blocker: ${e.authUser?e.authUser:e.AUTH_USER}, Reason: ${e.reason}`);"POST"==n?MENNAS.isPC?t.find(".gall_tit .blocked_info").length||t.find(".gall_tit").append(i):MENNAS.isMobile&&(t.find(".subject .blocked_info").length||t.find(".subject").append(i)):"COMMENT"==n&&(MENNAS.isPC?t.find(".cmt_txtbox .blocked_info").length||t.find(".cmt_txtbox").append(i):MENNAS.isMobile&&(t.find(".blocked_info").length||t.append(i)))}(t,n,e)):t.hide()}function p(t){var n=t&&!0===t.isBlocked,e=t&&void 0===t.isBlocked;return n||e}function f(t){return t&&t.isBlocked}const d="#recom_box1";function N(n){var e=t(location.href),a=n[e];a&&$(c).toArray().map(t=>$(t)).forEach(t=>{var n=l(t).no,e=a.comments[n];p(e)&&s(t,"COMMENT",e)}),$(o).toArray().map(t=>$(t)).forEach(t=>{var e=i(t).no,o=n[e];f(o)&&s(t,"POST",o)});var r=$(d).find("#recom_title_topLink").attr("href").match(/(?<=')(http|https):\/\/.+?(?=')/gi);if(r){var N=t(r=r[0]),u=n[N];f(u)&&s($(d),"POST",u)}}function u(t){MENNAS.isPC?function(t){var i=t[MENNAS.queryMap.no];i&&$(r).toArray().map(t=>$(t)).forEach(t=>{var n=a(t).no,e=i.comments[n];p(e)&&s(t,"COMMENT",e)}),$(e).toArray().map(t=>$(t)).forEach(e=>{var i=n(e).no,o=t[i];f(o)&&s(e,"POST",o)})}(t):MENNAS.isMobile&&N(t)}function _(){!function(){if(localStorage.MENNAS_CACHED_BLACKLIST)try{u(JSON.parse(localStorage.MENNAS_CACHED_BLACKLIST))}catch(t){}}(),fetch(MENNAS.blacklistServerURL+MENNAS.blacklistPath).then(t=>t.json()).then(t=>{u(t),localStorage.MENNAS_CACHED_BLACKLIST=JSON.stringify(t)})}function m(t,n){return function(t){return fetch(MENNAS.blacklistServerURL+MENNAS.requestPath,{method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded"},body:encodeURIComponent(btoa(encodeURIComponent(JSON.stringify(t))))}).then(t=>t.json())}(t).then(t=>{localStorage.MENNAS_CACHED_BLACKLIST=void 0,alert(n+"\n"+t.result)})}function S(){$(o).find(" .lt").toArray().map(t=>$(t)).forEach(t=>{if(!t.parent().find(".mt").toArray().length){var n=$('<a href="#" class="rt mt"><span class="ct">D</span></a>');n.on("click",t=>{var n=i(t=$(t.target).parent().parent()),e=n.no,o=`${n.no} ${n.subject} [${n.nick}]`,a=prompt(`${o}\n\n 이유를 입력해주세요`);a?m({cmd:"post_blacklist_request",no:e,info:n,reason:a,authUser:localStorage.MENNAS_AUTH_USER,authCode:localStorage.MENNAS_AUTH_CODE},o):alert("작업 취소됨")}),n[0].appendAfter(t[0])}})}function g(){$(r).find(".date_time").css("cursor","pointer"),$(r).find(".date_time").off("click").on("click",t=>{var n=a(t=$(t.target).parent().parent()),e=n.no,i=MENNAS.queryMap.no,o=`${n.no} ${n.comment} [${n.nick} ${n.ip}]`,r=prompt(`${o}\n\n이유를 입력해주세요`);r?m({cmd:"comment_blacklist_request",info:n,postNo:i,no:e,reason:r,authUser:localStorage.MENNAS_AUTH_USER,authCode:localStorage.MENNAS_AUTH_CODE},o):alert("작업 취소됨")})}function h(){$(c).find(".date").off("click").on("click",t=>{var n=l(t=$(t.target).parent()),e=n.no,i=location.href.split("/").pop().split("?").shift(),o=`${n.no} ${n.comment} [${n.nick}]`,a=prompt(`${o}\n\n이유를 입력해주세요`);a?m({cmd:"comment_blacklist_request",info:n,postNo:i,no:e,reason:a,authUser:localStorage.MENNAS_AUTH_USER,authCode:localStorage.MENNAS_AUTH_CODE},o):alert("작업 취소됨")})}function A(){localStorage.MENNAS_AUTH_USER=prompt("유저 이름을 입력해주세요"),localStorage.MENNAS_AUTH_CODE=prompt("코드를 입력해주세요"),localStorage.MENNAS_RESTORE_MODE=confirm("복구 모드를 사용할까요? (글이 가려지지 않음)"),alert(`성공적으로 멘나스 계정을 설정했습니다.\nMennas, the Voice of DCInside V${MENNAS.version}/WV${MENNAS.wrapperVersion}\nby ASCIIPhilia (https://mennas.roguelike.network)\nBlacklist Server: ${MENNAS.blacklistServerURL}\nGalleryId: ${MENNAS.galleryId}`)}const E={attributes:!0,childList:!0,characterData:!0};function M(){var t;_(),$(e).find(".gall_num").css("cursor","pointer"),$(e).find(".gall_num").on("click",t=>{var e=n(t=$(t.target).parent()),i=e.no,o=`${e.no} ${e.subject} [${e.nick} (${e.ip})]`,a=prompt(`${o}\n\n 이유를 입력해주세요`);a?m({cmd:"post_blacklist_request",no:i,info:e,reason:a,authUser:localStorage.MENNAS_AUTH_USER,authCode:localStorage.MENNAS_AUTH_CODE},o):alert("작업 취소됨")}),g(),function(){var t=$('<button type="button" class="" onclick="">멘나스</button>');t.on("click",A),$(".array_tab").append(t);var n=$('<button type="button" class="btn_white">멘나스</button>');n.on("click",A),$(".view_bottom_btnbox .fl").append(n)}(),t=$(`<div class="copyright"><a href="https://mennas.roguelike.network">Mennas V${MENNAS.version}/WV${MENNAS.wrapperVersion} by ASCIIPhilia</a></div>`),$(".dcfoot").append(t),self._viewComments=viewComments,viewComments=function(){_viewComments.apply(_viewComments,arguments),_(),g()}}function b(){var t,n;_(),h(),S(),(t=$('<a class="lnk" href="#">멘나스</a>')).on("click",A),$(".gall-lnk-box").append(t),n=$(`<a href="https://mennas.roguelike.network"><p class="cpt">Mennas V${MENNAS.version}/WV${MENNAS.wrapperVersion} by ASCIIPhilia</p></a>`),$(".ft-btm").append(n);var e=t=>{_(),h(),S()},i=new MutationObserver(e),o=new MutationObserver(e),a=new MutationObserver(e);try{i.observe($("section:has(.gall-detail-lst)")[0],E)}catch(t){}try{o.observe($(".gall-detail-lst")[0],E)}catch(t){}try{a.observe($("#comment_box")[0],E)}catch(t){}}!function(){try{self.MENNAS=JSON.parse(localStorage.MENNAS)}catch(t){return void console.error("Mennas Wrapper is not exist.")}var t;MENNAS.version="1.9",MENNAS.isPC=location.href.includes(`id=${MENNAS.galleryId}`),MENNAS.isMobile=location.href.includes(`/${MENNAS.galleryId}`),MENNAS.requestPath="/request",MENNAS.blacklistPath=`/blacklist?version=${MENNAS.version}`,MENNAS.queryMap=(t=[],window.location.search.replace(/[?&]+([^=&]+)=([^&]*)/gi,(n,e,i)=>t[e]=i),t),console.log(`%cMennas, the Voice of DCInside V${MENNAS.version}/WV${MENNAS.wrapperVersion}`,"font-size:450%;font-weight:bold;color:#413160;font-family:dotum;"),console.log("%cby ASCIIPhilia (https://mennas.roguelike.network)","font-size:150%;font-weight:bold;"),console.log(`Blacklist Server: ${MENNAS.blacklistServerURL}`),console.log(`GalleryId: ${MENNAS.galleryId}`)}(),MENNAS.isPC?M():MENNAS.isMobile&&b()}();
